<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì»¨í…ì¸  ì ìš© í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 20px;
        }
        .control-panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            height: fit-content;
        }
        .preview-panel {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .btn {
            background: #007bff;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 4px;
            font-size: 12px;
            width: 100%;
        }
        .btn:hover { background: #0056b3; }
        .btn.success { background: #28a745; }
        .btn.warning { background: #ffc107; color: black; }

        .upload-area {
            border: 2px dashed #ccc;
            padding: 20px;
            text-align: center;
            border-radius: 8px;
            margin: 10px 0;
            cursor: pointer;
            min-height: 80px;
        }
        .upload-area:hover {
            border-color: #007bff;
            background: #f8f9ff;
        }

        .content-section {
            background: #f8f9fa;
            padding: 10px;
            margin: 8px 0;
            border-radius: 5px;
            font-size: 12px;
        }

        .template-frame {
            width: 100%;
            height: 600px;
            border: none;
        }

        .status-bar {
            background: #e9ecef;
            padding: 10px;
            font-size: 12px;
            border-bottom: 1px solid #ddd;
        }

        .file-item {
            background: #e7f3ff;
            padding: 8px;
            margin: 4px 0;
            border-radius: 4px;
            font-size: 11px;
            border-left: 3px solid #007bff;
        }

        .section-preview {
            background: #fff3cd;
            padding: 8px;
            margin: 4px 0;
            border-radius: 4px;
            font-size: 11px;
            border-left: 3px solid #ffc107;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª ì»¨í…ì¸  ì ìš© í…ŒìŠ¤íŠ¸</h1>

    <div class="container">
        <!-- ì œì–´ íŒ¨ë„ -->
        <div class="control-panel">
            <h3>íŒŒì¼ ì—…ë¡œë“œ</h3>

            <div class="upload-area" id="uploadArea">
                <div>ğŸ“ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­</div>
                <div style="font-size: 10px; color: #666;">TXT, ì´ë¯¸ì§€, PDF, DOC</div>
                <input type="file" id="fileInput" multiple style="display: none;">
            </div>

            <div>
                <button class="btn success" onclick="loadSampleContent()">ìƒ˜í”Œ ì»¨í…ì¸  ë¡œë“œ</button>
                <button class="btn" onclick="analyzeContent()">ì»¨í…ì¸  ë¶„ì„</button>
                <button class="btn warning" onclick="applyToTemplate()">í…œí”Œë¦¿ì— ì ìš©</button>
                <button class="btn" onclick="clearAll()">ì „ì²´ ì´ˆê¸°í™”</button>
            </div>

            <div id="uploadedFiles"></div>

            <h4>ë¶„ì„ ê²°ê³¼</h4>
            <div id="analysisResults"></div>

            <h4>ì„¹ì…˜ ë§¤ì¹­</h4>
            <div id="sectionMapping"></div>
        </div>

        <!-- ë¯¸ë¦¬ë³´ê¸° íŒ¨ë„ -->
        <div class="preview-panel">
            <div class="status-bar">
                <span>ìƒíƒœ: </span><span id="templateStatus">ëŒ€ê¸°ì¤‘</span>
                <span style="float: right;">
                    <button onclick="reloadTemplate()" style="padding: 2px 8px; font-size: 10px;">ìƒˆë¡œê³ ì¹¨</button>
                    <button onclick="openInNewTab()" style="padding: 2px 8px; font-size: 10px;">ìƒˆ íƒ­</button>
                </span>
            </div>
            <iframe id="templateFrame" class="template-frame" src="../templates/modified/eventre-business-test/index.html"></iframe>
        </div>
    </div>

    <script>
        let uploadedFiles = [];
        let analysisResults = null;
        let currentTemplate = '../templates/modified/eventre-business-test/index.html';

        // DOM ìš”ì†Œë“¤
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const uploadedFilesDiv = document.getElementById('uploadedFiles');
        const analysisResultsDiv = document.getElementById('analysisResults');
        const sectionMappingDiv = document.getElementById('sectionMapping');
        const templateStatusSpan = document.getElementById('templateStatus');
        const templateFrame = document.getElementById('templateFrame');

        // ì´ë²¤íŠ¸ ì„¤ì •
        uploadArea.addEventListener('click', () => fileInput.click());
        uploadArea.addEventListener('dragover', handleDragOver);
        uploadArea.addEventListener('drop', handleDrop);
        fileInput.addEventListener('change', handleFileSelect);

        function handleDragOver(e) {
            e.preventDefault();
            uploadArea.style.backgroundColor = '#f0f7ff';
        }

        function handleDrop(e) {
            e.preventDefault();
            uploadArea.style.backgroundColor = '';
            const files = Array.from(e.dataTransfer.files);
            processFiles(files);
        }

        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            processFiles(files);
        }

        // ìƒ˜í”Œ ì»¨í…ì¸  ë¡œë“œ
        function loadSampleContent() {
            const sampleFiles = [
                {
                    id: 'sample_company',
                    name: 'íšŒì‚¬ì†Œê°œ.txt',
                    type: 'document',
                    content: {
                        type: 'text',
                        text: `íšŒì‚¬ëª…: í˜ì‹  ì†”ë£¨ì…˜ ê¸°ì—… (Innovation Solutions Inc.)\n\në¹„ì „\nìš°ë¦¬ëŠ” ìµœì²¨ë‹¨ ê¸°ìˆ ê³¼ ì°½ì˜ì  ì‚¬ê³ ë¡œ ê³ ê°ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ì„±ê³µì„ ì´ë„ëŠ” ê¸€ë¡œë²Œ ì„ ë„ ê¸°ì—…ì´ ë˜ê³ ì í•©ë‹ˆë‹¤.\n\në¯¸ì…˜\n- ê³ ê° ì¤‘ì‹¬ì˜ ë§ì¶¤í˜• ì†”ë£¨ì…˜ ì œê³µ\n- ì§€ì†ì ì¸ ê¸°ìˆ  í˜ì‹ ê³¼ ì—°êµ¬ê°œë°œ\n- ì‚¬íšŒì  ì±…ì„ì„ ë‹¤í•˜ëŠ” ê¸°ì—… ê²½ì˜`
                    }
                },
                {
                    id: 'sample_services',
                    name: 'ì„œë¹„ìŠ¤ì•ˆë‚´.txt',
                    type: 'document',
                    content: {
                        type: 'text',
                        text: `í•µì‹¬ ì„œë¹„ìŠ¤\n\n1. ë””ì§€í„¸ íŠ¸ëœìŠ¤í¬ë©”ì´ì…˜ ì»¨ì„¤íŒ…\n   - ê¸°ì—…ì˜ ë””ì§€í„¸ ì „í™˜ì„ ìœ„í•œ ì „ëµ ìˆ˜ë¦½\n   - ìµœì ì˜ ê¸°ìˆ  ì†”ë£¨ì…˜ ë„ì… ì§€ì›\n\n2. í´ë¼ìš°ë“œ ì†”ë£¨ì…˜\n   - AWS, Azure, GCP ê¸°ë°˜ í´ë¼ìš°ë“œ ì•„í‚¤í…ì²˜ ì„¤ê³„\n   - 24/7 ìš´ì˜ ë° ëª¨ë‹ˆí„°ë§ ì„œë¹„ìŠ¤\n\n3. AI/ML ì†”ë£¨ì…˜\n   - ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ ê°œë°œ ë° ë°°í¬\n   - ìì—°ì–´ ì²˜ë¦¬ ë° ì´ë¯¸ì§€ ì¸ì‹ ì‹œìŠ¤í…œ`
                    }
                },
                {
                    id: 'sample_team',
                    name: 'íŒ€ì†Œê°œ.txt',
                    type: 'document',
                    content: {
                        type: 'text',
                        text: `íŒ€ ì†Œê°œ\n\nê¹€í˜ì‹  (ëŒ€í‘œì´ì‚¬)\n- ì„œìš¸ëŒ€í•™êµ ì»´í“¨í„°ê³µí•™ê³¼ ì¡¸ì—…\n- ì‚¼ì„±ì „ì ì†Œí”„íŠ¸ì›¨ì–´ì„¼í„° 15ë…„ ê·¼ë¬´\n- í´ë¼ìš°ë“œ ë° AI ë¶„ì•¼ ì „ë¬¸ê°€\n\në°•ê¸°ìˆ  (CTO)\n- KAIST ì „ì‚°í•™ê³¼ ë°•ì‚¬\n- êµ¬ê¸€ ì½”ë¦¬ì•„ ìˆ˜ì„ ì—”ì§€ë‹ˆì–´ ì¶œì‹ \n- ë¨¸ì‹ ëŸ¬ë‹ ë° ë¹…ë°ì´í„° ì „ë¬¸ê°€`
                    }
                },
                {
                    id: 'sample_contact',
                    name: 'ì—°ë½ì²˜.txt',
                    type: 'document',
                    content: {
                        type: 'text',
                        text: `ì—°ë½ì²˜ ì •ë³´\n\nì£¼ì†Œ: ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123, í˜ì‹ íƒ€ì›Œ 15ì¸µ\nì „í™”: 02-1234-5678\níŒ©ìŠ¤: 02-1234-5679\nì´ë©”ì¼: contact@innovation-solutions.co.kr\nì›¹ì‚¬ì´íŠ¸: www.innovation-solutions.co.kr\n\nì‚¬ì—…ìë“±ë¡ë²ˆí˜¸: 123-45-67890\nëŒ€í‘œì´ì‚¬: ê¹€í˜ì‹ `
                    }
                }
            ];

            uploadedFiles = [...uploadedFiles, ...sampleFiles];
            displayUploadedFiles();
            updateStatus('ìƒ˜í”Œ ì»¨í…ì¸  ë¡œë“œë¨');
        }

        // íŒŒì¼ ì²˜ë¦¬
        async function processFiles(files) {
            for (const file of files) {
                try {
                    const result = await processFile(file);
                    uploadedFiles.push(result);
                } catch (error) {
                    console.error('íŒŒì¼ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                }
            }
            displayUploadedFiles();
        }

        async function processFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                const result = {
                    id: Date.now() + '_' + Math.random().toString(36).substr(2, 5),
                    name: file.name,
                    type: getFileType(file.name),
                    content: null
                };

                if (file.type.startsWith('text/')) {
                    reader.onload = (e) => {
                        result.content = {
                            type: 'text',
                            text: e.target.result
                        };
                        resolve(result);
                    };
                    reader.readAsText(file);
                } else if (file.type.startsWith('image/')) {
                    reader.onload = (e) => {
                        result.content = {
                            type: 'image',
                            dataUrl: e.target.result
                        };
                        resolve(result);
                    };
                    reader.readAsDataURL(file);
                } else {
                    result.content = { type: 'document', text: `[${file.name}]` };
                    resolve(result);
                }

                reader.onerror = () => reject(new Error('íŒŒì¼ ì½ê¸° ì‹¤íŒ¨'));
            });
        }

        function getFileType(fileName) {
            const ext = fileName.toLowerCase().split('.').pop();
            if (['jpg', 'jpeg', 'png', 'gif'].includes(ext)) return 'image';
            if (['txt', 'pdf', 'doc', 'docx'].includes(ext)) return 'document';
            return 'unknown';
        }

        // UI ì—…ë°ì´íŠ¸
        function displayUploadedFiles() {
            uploadedFilesDiv.innerHTML = '';
            uploadedFiles.forEach(file => {
                const div = document.createElement('div');
                div.className = 'file-item';
                div.innerHTML = `ğŸ“„ ${file.name} (${file.type})`;
                uploadedFilesDiv.appendChild(div);
            });
        }

        function displayAnalysisResults(results) {
            analysisResultsDiv.innerHTML = `
                <div class="content-section">
                    ğŸ“Š ì´ íŒŒì¼: ${uploadedFiles.length}ê°œ<br>
                    ğŸ“ ë¬¸ì„œ: ${uploadedFiles.filter(f => f.type === 'document').length}ê°œ<br>
                    ğŸ–¼ï¸ ì´ë¯¸ì§€: ${uploadedFiles.filter(f => f.type === 'image').length}ê°œ<br>
                    ğŸ¯ ì‹ ë¢°ë„: ${Math.round(results.confidence * 100)}%
                </div>
            `;
        }

        function displaySectionMapping(sections) {
            sectionMappingDiv.innerHTML = '';

            for (const [sectionName, files] of Object.entries(sections)) {
                const div = document.createElement('div');
                div.className = 'section-preview';
                div.innerHTML = `
                    <strong>${getSectionDisplayName(sectionName)}</strong><br>
                    ${files.map(f => `ğŸ“„ ${f.name}`).join('<br>')}
                `;
                sectionMappingDiv.appendChild(div);
            }
        }

        // ì»¨í…ì¸  ë¶„ì„
        function analyzeContent() {
            if (uploadedFiles.length === 0) {
                alert('íŒŒì¼ì„ ë¨¼ì € ì—…ë¡œë“œí•˜ì„¸ìš”.');
                return;
            }

            updateStatus('ë¶„ì„ì¤‘...');

            const sections = {};
            uploadedFiles.forEach(file => {
                const fileName = file.name.toLowerCase();
                let section = 'general';

                if (fileName.includes('íšŒì‚¬') || fileName.includes('ì†Œê°œ') ||
                    (file.content?.text && file.content.text.includes('íšŒì‚¬'))) {
                    section = 'hero';
                } else if (fileName.includes('ì„œë¹„ìŠ¤') ||
                          (file.content?.text && file.content.text.includes('ì„œë¹„ìŠ¤'))) {
                    section = 'services';
                } else if (fileName.includes('íŒ€') ||
                          (file.content?.text && file.content.text.includes('íŒ€'))) {
                    section = 'team';
                } else if (fileName.includes('ì—°ë½') ||
                          (file.content?.text && file.content.text.includes('ì—°ë½'))) {
                    section = 'contact';
                }

                if (!sections[section]) {
                    sections[section] = [];
                }
                sections[section].push(file);
            });

            analysisResults = {
                sections: sections,
                confidence: Object.keys(sections).length > 0 ? 0.85 : 0.3
            };

            displayAnalysisResults(analysisResults);
            displaySectionMapping(sections);
            updateStatus('ë¶„ì„ ì™„ë£Œ');
        }

        // í…œí”Œë¦¿ì— ì ìš©
        function applyToTemplate() {
            if (!analysisResults) {
                alert('ë¨¼ì € ì»¨í…ì¸  ë¶„ì„ì„ ìˆ˜í–‰í•˜ì„¸ìš”.');
                return;
            }

            updateStatus('í…œí”Œë¦¿ì— ì ìš©ì¤‘...');

            // ì‹¤ì œë¡œëŠ” ì—¬ê¸°ì—ì„œ í…œí”Œë¦¿ HTMLì„ ìˆ˜ì •í•˜ê³  ì»¨í…ì¸ ë¥¼ ì‚½ì…
            // í˜„ì¬ëŠ” ì‹œë®¬ë ˆì´ì…˜ë§Œ ìˆ˜í–‰
            setTimeout(() => {
                updateStatus('ì ìš© ì™„ë£Œ');
                reloadTemplate();
                alert('ì»¨í…ì¸ ê°€ í…œí”Œë¦¿ì— ì„±ê³µì ìœ¼ë¡œ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }, 2000);
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function getSectionDisplayName(section) {
            const names = {
                'hero': 'ğŸ  ë©”ì¸ ì„¹ì…˜',
                'services': 'âš™ï¸ ì„œë¹„ìŠ¤',
                'team': 'ğŸ‘¥ íŒ€ ì†Œê°œ',
                'contact': 'ğŸ“ ì—°ë½ì²˜',
                'gallery': 'ğŸ–¼ï¸ ê°¤ëŸ¬ë¦¬',
                'general': 'ğŸ“„ ì¼ë°˜'
            };
            return names[section] || section;
        }

        function updateStatus(status) {
            templateStatusSpan.textContent = status;
        }

        function reloadTemplate() {
            const currentSrc = templateFrame.src;
            templateFrame.src = '';
            setTimeout(() => {
                templateFrame.src = currentSrc + '?t=' + Date.now();
            }, 100);
        }

        function openInNewTab() {
            window.open(currentTemplate, '_blank');
        }

        function clearAll() {
            uploadedFiles = [];
            analysisResults = null;
            uploadedFilesDiv.innerHTML = '';
            analysisResultsDiv.innerHTML = '';
            sectionMappingDiv.innerHTML = '';
            fileInput.value = '';
            updateStatus('ëŒ€ê¸°ì¤‘');
        }

        // ì´ˆê¸°í™”
        console.log('ì»¨í…ì¸  ì ìš© í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
    </script>
</body>
</html>
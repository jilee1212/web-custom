<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í…œí”Œë¦¿ ì—°ë™ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .upload-area {
            border: 2px dashed #ccc;
            padding: 30px;
            text-align: center;
            border-radius: 8px;
            margin: 20px 0;
            cursor: pointer;
        }
        .upload-area:hover {
            border-color: #007bff;
            background: #f8f9ff;
        }
        .file-item {
            background: #f8f9fa;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 4px solid #28a745;
        }
        .btn {
            background: #007bff;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 2px;
            font-size: 12px;
        }
        .btn:hover { background: #0056b3; }
        .btn.success { background: #28a745; }
        .btn.danger { background: #dc3545; }

        .template-preview {
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            max-height: 500px;
            position: relative;
        }
        .template-preview iframe {
            width: 100%;
            height: 400px;
            border: none;
        }
        .section-mapping {
            margin-top: 10px;
        }
        .section-item {
            background: #e7f3ff;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        .results {
            margin-top: 15px;
            padding: 15px;
            background: #d4edda;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }
        .status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.ready { background: #d4edda; color: #155724; }
        .status.processing { background: #fff3cd; color: #856404; }
        .status.completed { background: #cce7ff; color: #004085; }
    </style>
</head>
<body>
    <h1>ğŸ”— í…œí”Œë¦¿ ì—°ë™ í…ŒìŠ¤íŠ¸</h1>

    <div class="container">
        <!-- ì™¼ìª½ íŒ¨ë„: íŒŒì¼ ì—…ë¡œë“œ ë° ë¶„ì„ -->
        <div class="panel">
            <h2>ğŸ“ íŒŒì¼ ì—…ë¡œë“œ & ë¶„ì„</h2>

            <div class="upload-area" id="uploadArea">
                <h4>íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì„¸ìš”</h4>
                <p>ì§€ì›: TXT, ì´ë¯¸ì§€, PDF, DOC</p>
                <input type="file" id="fileInput" multiple style="display: none;">
            </div>

            <div>
                <button class="btn" onclick="clearFiles()">ì´ˆê¸°í™”</button>
                <button class="btn success" onclick="analyzeContent()">ì»¨í…ì¸  ë¶„ì„</button>
                <button class="btn" onclick="generateWebsite()">ì›¹ì‚¬ì´íŠ¸ ìƒì„±</button>
            </div>

            <div id="fileList"></div>

            <div class="section-mapping" id="sectionMapping" style="display: none;">
                <h4>ğŸ“‹ ì„¹ì…˜ ë§¤ì¹­ ê²°ê³¼</h4>
                <div id="mappingResults"></div>
            </div>
        </div>

        <!-- ì˜¤ë¥¸ìª½ íŒ¨ë„: í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸° -->
        <div class="panel">
            <h2>ğŸ¨ í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸°</h2>

            <div style="margin-bottom: 15px;">
                <span>ìƒíƒœ: </span>
                <span class="status ready" id="templateStatus">ì¤€ë¹„ë¨</span>
                <button class="btn" onclick="reloadTemplate()">ìƒˆë¡œê³ ì¹¨</button>
                <button class="btn" onclick="openInNewTab()">ìƒˆ íƒ­ì—ì„œ ì—´ê¸°</button>
            </div>

            <div class="template-preview">
                <iframe id="templateFrame" src="../templates/modified/eventre-business-test/index.html"></iframe>
            </div>

            <div class="results" id="results" style="display: none;">
                <h4>âœ… ìƒì„± ì™„ë£Œ</h4>
                <p id="resultMessage">ì›¹ì‚¬ì´íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!</p>
            </div>
        </div>
    </div>

    <script>
        let uploadedFiles = [];
        let analysisResults = null;

        // DOM ìš”ì†Œë“¤
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const sectionMapping = document.getElementById('sectionMapping');
        const mappingResults = document.getElementById('mappingResults');
        const templateStatus = document.getElementById('templateStatus');
        const templateFrame = document.getElementById('templateFrame');
        const results = document.getElementById('results');
        const resultMessage = document.getElementById('resultMessage');

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        uploadArea.addEventListener('click', () => fileInput.click());
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.backgroundColor = '#f0f7ff';
        });
        uploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadArea.style.backgroundColor = '';
        });
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.backgroundColor = '';
            const files = Array.from(e.dataTransfer.files);
            processFiles(files);
        });
        fileInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            processFiles(files);
        });

        // íŒŒì¼ ì²˜ë¦¬ í•¨ìˆ˜
        async function processFiles(files) {
            for (const file of files) {
                try {
                    const result = await processFile(file);
                    uploadedFiles.push(result);
                    displayFile(result);
                } catch (error) {
                    console.error('íŒŒì¼ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                }
            }
        }

        async function processFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                const result = {
                    id: Date.now() + '_' + Math.random().toString(36).substr(2, 5),
                    name: file.name,
                    size: file.size,
                    type: getFileType(file.name),
                    content: null
                };

                if (file.type.startsWith('text/')) {
                    reader.onload = (e) => {
                        result.content = {
                            type: 'text',
                            text: e.target.result
                        };
                        resolve(result);
                    };
                    reader.readAsText(file);
                } else if (file.type.startsWith('image/')) {
                    reader.onload = (e) => {
                        result.content = {
                            type: 'image',
                            dataUrl: e.target.result
                        };
                        resolve(result);
                    };
                    reader.readAsDataURL(file);
                } else {
                    result.content = { type: 'document', text: `[${file.name}]` };
                    resolve(result);
                }

                reader.onerror = () => reject(new Error('íŒŒì¼ ì½ê¸° ì‹¤íŒ¨'));
            });
        }

        function getFileType(fileName) {
            const ext = fileName.toLowerCase().split('.').pop();
            if (['jpg', 'jpeg', 'png', 'gif'].includes(ext)) return 'image';
            if (['txt', 'pdf', 'doc', 'docx'].includes(ext)) return 'document';
            return 'unknown';
        }

        function displayFile(file) {
            const div = document.createElement('div');
            div.className = 'file-item';
            div.innerHTML = `
                <strong>${file.name}</strong> (${formatFileSize(file.size)})
                <span style="float: right; color: #666;">${file.type}</span>
            `;
            fileList.appendChild(div);
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        // ì»¨í…ì¸  ë¶„ì„
        function analyzeContent() {
            if (uploadedFiles.length === 0) {
                alert('ë¨¼ì € íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.');
                return;
            }

            templateStatus.className = 'status processing';
            templateStatus.textContent = 'ë¶„ì„ì¤‘...';

            // ê°„ë‹¨í•œ ì„¹ì…˜ ë§¤ì¹­ ë¡œì§
            const sections = {};
            uploadedFiles.forEach(file => {
                const fileName = file.name.toLowerCase();
                let section = 'general';

                if (fileName.includes('íšŒì‚¬') || fileName.includes('ì†Œê°œ') ||
                    (file.content && file.content.text && file.content.text.includes('íšŒì‚¬'))) {
                    section = 'hero';
                } else if (fileName.includes('ì„œë¹„ìŠ¤') ||
                          (file.content && file.content.text && file.content.text.includes('ì„œë¹„ìŠ¤'))) {
                    section = 'services';
                } else if (fileName.includes('íŒ€') ||
                          (file.content && file.content.text && file.content.text.includes('íŒ€'))) {
                    section = 'team';
                } else if (fileName.includes('ì—°ë½') ||
                          (file.content && file.content.text && file.content.text.includes('ì—°ë½'))) {
                    section = 'contact';
                } else if (file.type === 'image') {
                    section = 'gallery';
                }

                if (!sections[section]) {
                    sections[section] = [];
                }
                sections[section].push(file);
            });

            analysisResults = sections;
            displayMappingResults(sections);

            setTimeout(() => {
                templateStatus.className = 'status ready';
                templateStatus.textContent = 'ë¶„ì„ì™„ë£Œ';
            }, 1000);
        }

        function displayMappingResults(sections) {
            sectionMapping.style.display = 'block';
            mappingResults.innerHTML = '';

            for (const [sectionName, files] of Object.entries(sections)) {
                const div = document.createElement('div');
                div.className = 'section-item';
                div.innerHTML = `
                    <strong>${getSectionDisplayName(sectionName)}</strong>
                    <div style="font-size: 12px; margin-top: 5px;">
                        ${files.map(f => f.name).join(', ')}
                    </div>
                `;
                mappingResults.appendChild(div);
            }
        }

        function getSectionDisplayName(section) {
            const names = {
                'hero': 'ğŸ  ë©”ì¸ ì„¹ì…˜',
                'services': 'âš™ï¸ ì„œë¹„ìŠ¤',
                'team': 'ğŸ‘¥ íŒ€ ì†Œê°œ',
                'contact': 'ğŸ“ ì—°ë½ì²˜',
                'gallery': 'ğŸ–¼ï¸ ê°¤ëŸ¬ë¦¬',
                'general': 'ğŸ“„ ì¼ë°˜'
            };
            return names[section] || section;
        }

        // ì›¹ì‚¬ì´íŠ¸ ìƒì„±
        function generateWebsite() {
            if (!analysisResults) {
                alert('ë¨¼ì € ì»¨í…ì¸  ë¶„ì„ì„ ìˆ˜í–‰í•˜ì„¸ìš”.');
                return;
            }

            templateStatus.className = 'status processing';
            templateStatus.textContent = 'ìƒì„±ì¤‘...';

            // ì‹¤ì œë¡œëŠ” ë¶„ì„ëœ ì»¨í…ì¸ ë¥¼ í…œí”Œë¦¿ì— ì ìš©í•˜ëŠ” ë¡œì§ì´ í•„ìš”
            // ì—¬ê¸°ì„œëŠ” ì‹œë®¬ë ˆì´ì…˜ë§Œ ìˆ˜í–‰
            setTimeout(() => {
                templateStatus.className = 'status completed';
                templateStatus.textContent = 'ìƒì„±ì™„ë£Œ';

                results.style.display = 'block';
                resultMessage.innerHTML = `
                    <p>âœ… ì›¹ì‚¬ì´íŠ¸ ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</p>
                    <p><strong>ì²˜ë¦¬ëœ íŒŒì¼:</strong> ${uploadedFiles.length}ê°œ</p>
                    <p><strong>ë§¤ì¹­ëœ ì„¹ì…˜:</strong> ${Object.keys(analysisResults).length}ê°œ</p>
                    <p><strong>ì‚¬ìš©ëœ í…œí”Œë¦¿:</strong> Eventre Business</p>
                `;

                // í…œí”Œë¦¿ ìƒˆë¡œê³ ì¹¨
                reloadTemplate();
            }, 2000);
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function clearFiles() {
            uploadedFiles = [];
            analysisResults = null;
            fileList.innerHTML = '';
            sectionMapping.style.display = 'none';
            results.style.display = 'none';
            fileInput.value = '';
            templateStatus.className = 'status ready';
            templateStatus.textContent = 'ì¤€ë¹„ë¨';
        }

        function reloadTemplate() {
            const currentSrc = templateFrame.src;
            templateFrame.src = '';
            setTimeout(() => {
                templateFrame.src = currentSrc;
            }, 100);
        }

        function openInNewTab() {
            const templateUrl = '../templates/modified/eventre-business-test/index.html';
            window.open(templateUrl, '_blank');
        }

        // ì´ˆê¸°í™”
        console.log('í…œí”Œë¦¿ ì—°ë™ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
        console.log('ì—…ë¡œë“œ ê°€ëŠ¥í•œ íŒŒì¼:', uploadedFiles);
    </script>
</body>
</html>